# Rest API Maps Polygons

Парсинг файла и расчёт вхождения локаций из него в заданные полигоны. 
Приложение работает на сервере Express JS, с подключенной к нему базой данных MongoDB.
Авторизация работает через JWT-токены.

## Инструкции

Немного инструкций по запуску проекта

### Подготовка к запуску

Для запуска проекта, необходимо скачать репозиторий и установить необходимые модули

```
npm install
```

### Описание работы проекта

#### Конфигурация

Все настраиваемые данные можно найти по пути:

```
/src/config.js
```

**database** - настройка базы данных
* url - путь к базе данных с учётными данными пользователя
* dbname - имя базы

**app** - основные настройки сервера
* port - на каком порте будет работать сервер
* upload_dir - директория, в которой будут располагаться загруженные файлы.
В конце пути необходимо обязательно добавить */{username}* для корректной работы приложения с файлами разных пользователей

**auth** - настройка авторизационных параметров
* token - секретный ключ для работы JWT-авторизации
* sessionTime - максимальная длительность сессии в секундах
* error_view - указание какой view-файл отображать при ошибках в авторизации клиента

**polygons** - настройки для парсинга файлов
*precalculate - параметр, указывающий на какой стадии совершать просчет вхождения точек в полигон:
***true*** - на стадии загрузки файла на сервер, ***false*** - на стадии выгрузки страницы клиенту.

Сами полигоны хранятся по пути:

```/src/data/polygons.js```

### Список доступных API-вызовов:

Методы API подключаются через файлы по пути:

```/src/api```

По умолчанию адрес API

```http://SERVERPATH/api/```

Каждый файл добавляет к API свое название

#### Авторизация 

**POST** ```http://SERVERPATH/api/auth/signin``` 
 -авторизация пользователя

Параметры:
* username
* password

**POST** ```http://SERVERPATH/api/auth/register``` 
 -регистрация пользователя 
 (отчлючено для безопасности, для включения раскомментируйте соответствующий блок кода)

Параметры:
* username
* password

#### Работа с файлами

**GET** ```http://SERVERPATH/api/files``` 
 -список файлов пользователя

**POST** ```http://SERVERPATH/api/files``` 
 -добавление нового файла

Параметры:
* formData (multipart/form-data)


**GET** ```http://SERVERPATH/api/files/:filename``` 
 -запрос необходимого файла

Параметры:
* filename

### Работа с файлами

Файл для загрузки должен быть оформлет в следующем формате:
````
[ <longitude: float>, <latitude: float> ] Название объекта 
[ 37.622006, 55.730358 ] Москва, точка 1
````

Загруженный файл добавляется в очередь на парсинг, который производится построчно. 
Полученные значения (координаты и название локации) добавляются в базу данных, 
что избавляет от необходимости тратить ресурсы на парсинг каждый раз при открытии файла.
Файл убирается из очереди только после окончания парсинга и загрузки в базу - 
это позволяет избежать потери данных при обрывах связи и прочих непредвиденных обстоятельств.

Анализ вхождения точек в указанную область происходит на этапе, зависящим от параметра precalculate в конфигурационном файле.
Все файлы пользователя можно найти по пути:
```/files/имя пользователя```

Название файла генирируется исходя из даты и времени загрузки и имеет формат: ***YYYYMMDD-HHmmss***
